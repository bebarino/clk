# SPDX-License-Identifier: (GPL-2.0-only OR BSD-2-Clause)
%YAML 1.2
---
$id: http://devicetree.org/schemas/usb/usb-switch.yaml#
$schema: http://devicetree.org/meta-schemas/core.yaml#

title: USB Orientation and Mode Switches Common Properties

maintainers:
  - Greg Kroah-Hartman <gregkh@linuxfoundation.org>

description:
  Common properties for devices handling USB mode and orientation switching.

properties:
  mode-switch:
    description: Possible handler of altmode switching
    type: boolean

  orientation-switch:
    description: Possible handler of orientation switching
    type: boolean

  retimer-switch:
    description: Possible handler of SuperSpeed signals retiming
    type: boolean

  port:
    $ref: /schemas/graph.yaml#/properties/port
    description:
      A port node to link the device to a TypeC controller for the purpose of
      handling altmode muxing and orientation switching.

  ports:
    $ref: /schemas/graph.yaml#/properties/ports
    properties:
      port@0:
        $ref: /schemas/graph.yaml#/$defs/port-base
        unevaluatedProperties: false

        properties:
          endpoint:
            $ref: '#/$defs/usbc-out-endpoint'

      port@1:
        $ref: /schemas/graph.yaml#/$defs/port-base
        description:
          Super Speed (SS) Input endpoint from the Super-Speed PHY
        unevaluatedProperties: false

        properties:
          endpoint:
            $ref: '#/$defs/usbc-in-endpoint'

oneOf:
  - required:
      - port
  - required:
      - ports

additionalProperties: true

$defs:
  usbc-out-endpoint:
    $ref: /schemas/graph.yaml#/$defs/endpoint-base
    description: Super Speed (SS) output endpoint to a type-c connector
    unevaluatedProperties: false

  usbc-in-endpoint:
    $ref: /schemas/graph.yaml#/$defs/endpoint-base
    description: Super Speed (SS) input endpoint from the Super Speed PHY
    unevaluatedProperties: false
    properties:
      data-lanes:
        $ref: /schemas/types.yaml#/definitions/uint32-array
        minItems: 1
        maxItems: 8
        uniqueItems: true
        items:
          maximum: 8

examples:
  # A USB orientation switch which flips the pin orientation
  # for a usb-c-connector node.
  - |
    device {
      orientation-switch;

      ports {
        #address-cells = <1>;
        #size-cells = <0>;

        port@0 {
          reg = <0>;
          #address-cells = <1>;
          #size-cells = <0>;

          endpoint {
            remote-endpoint = <&usb_c_connector>;
          };
        };

        port@1 {
          reg = <1>;
          #address-cells = <1>;
          #size-cells = <0>;

          endpoint {
            remote-endpoint = <&usb_ss_phy>;
          };
        };
      };
    };

...
